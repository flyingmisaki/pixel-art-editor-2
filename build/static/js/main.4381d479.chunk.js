(this["webpackJsonppixel-react"]=this["webpackJsonppixel-react"]||[]).push([[0],{109:function(t,e,n){},110:function(t,e,n){},111:function(t,e,n){},112:function(t,e,n){},219:function(t,e,n){},220:function(t,e,n){},221:function(t,e,n){},222:function(t,e,n){},223:function(t,e,n){},224:function(t,e,n){},225:function(t,e,n){},226:function(t,e,n){},227:function(t,e,n){},228:function(t,e,n){},229:function(t,e,n){},230:function(t,e,n){},231:function(t,e,n){"use strict";n.r(e);var i=n(0),s=n.n(i),a=n(79),o=n.n(a),c=(n(94),n(80)),r=(n(97),n(98),n(99),n(4)),l=n(13),u=n(5),h=n(9),v=n(7),d=n(8),f=n(83),j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(v.a)(this,t),this.id=f.generate(),this.name=e,this.canvasRef=null,this.isVisible=!0,this.isLocked=!1,this.listeners=[],this.width=16,this.height=16}return Object(d.a)(t,[{key:"setName",value:function(t){this.name=t,this.onUpdate()}},{key:"onUpdate",value:function(){this.listeners.forEach((function(t){return t()}))}},{key:"addUpdateListener",value:function(t){this.listeners.push(t)}},{key:"removeUpdateListener",value:function(t){this.listeners=this.listeners.filter((function(e){return e!==t}))}},{key:"toggleVisibility",value:function(){this.isVisible=!this.isVisible,this.onUpdate()}},{key:"toggleLock",value:function(){this.isLocked=!this.isLocked,this.onUpdate()}}]),t}(),x=j,b=n(1),y=Object(i.createContext)();function O(){return Object(i.useContext)(y)}function p(t){var e=Object(i.useState)([]),n=Object(u.a)(e,2),s=n[0],a=n[1],o=Object(i.useState)(null),c=Object(u.a)(o,2),r=c[0],h=c[1],v=Object(i.useRef)(0),d=function(){var t=v.current,e="Layer ".concat(t),n=new x(e),i=[].concat(Object(l.a)(s),[n]);return v.current+=1,h(n),a(i),n};Object(i.useEffect)(d,[]);var f={layers:s,activeLayer:r,setLayers:a,addLayer:d,removeLayer:function(t){if(t&&!t.isLocked){if(t.id===(null===r||void 0===r?void 0:r.id)){var e=s.indexOf(t);1===s.length?h(null):h(0===e?s[e+1]:s[e-1])}t.listeners=[];var n=s.filter((function(e){return e.id!==t.id}));a(n)}},setActiveLayer:h};return Object(b.jsx)(y.Provider,{value:f,children:t.children})}var m=Object(i.createContext)();function g(){return Object(i.useContext)(m)}function C(t){var e=Object(i.useState)({x:null,y:null}),n=Object(u.a)(e,2),s=n[0],a=n[1],o=Object(i.useRef)(null),c=Object(i.useState)(32),r=Object(u.a)(c,2),l=r[0],h=r[1],v=Object(i.useState)(32),d=Object(u.a)(v,2),f=d[0],j=d[1],x=Object(i.useState)(25),y=Object(u.a)(x,2),O=y[0],p=y[1],g=Object(i.useState)(0),C=Object(u.a)(g,2),w=C[0],k=C[1],S=Object(i.useState)(0),P=Object(u.a)(S,2),L={canvasCursorPosition:s,setCanvasCursorPosition:a,previewLayerCanvasRef:o,width:l,setWidth:h,height:f,setHeight:j,scale:O,setScale:p,canvasX:w,setCanvasX:k,canvasY:P[0],setCanvasY:P[1]};return Object(b.jsx)(m.Provider,{value:L,children:t.children})}var w=function t(e){Object(v.a)(this,t),this.layers=e.map((function(t){return new k(t)}))},k=function t(e){Object(v.a)(this,t),this.imageData=e.canvasRef.current.toDataURL("image/png"),this.metaData=Object(h.a)({},e),delete this.metaData.canvasRef},S=function(t,e){Object.assign(t,e.metaData),function(t,e){return new Promise((function(n,i){var s=t.getContext("2d"),a=new Image;a.src=e.imageData,a.onload=function(){s.drawImage(a,0,0),n()}}))}(t.canvasRef.current,e).then((function(){return t.onUpdate()}))},P=Object(i.createContext)();function L(){return Object(i.useContext)(P)}function N(t){var e=O(),n=e.layers,s=e.addLayer,a=e.removeLayer,o=g(),c=o.width,r=o.height,h=Object(i.useState)([]),v=Object(u.a)(h,2),d=v[0],f=v[1],j=Object(i.useState)(-1),x=Object(u.a)(j,2),y=x[0],p=x[1],m=y>0,C=y<d.length-1,k=Object(i.useRef)(null),L=function(t){n.forEach((function(e){t.layers.some((function(t){return t.metaData.id===e.id}))?(e.canvasRef.current.getContext("2d").clearRect(0,0,c,r),e.onUpdate()):a(e)})),t.layers.forEach((function(t){var e=n.find((function(e){return e.id===t.metaData.id}));if(e)S(e,t);else{var i=s();k.current=[i,t],S(i,t)}}))},N={undo:function(){if(m){p(y-1);var t=d[y-1];L(t)}},redo:function(){if(C){p(y+1);var t=d[y+1];L(t)}},canUndo:m,canRedo:C,pushEntryToHistory:function(){var t=new w(n);p(y+1);var e=d.slice(0,y+1),i=[].concat(Object(l.a)(e),[t]);f(i)},clearHistory:function(){f([])}};return Object(b.jsx)(P.Provider,{value:N,children:t.children})}function R(){var t=L(),e=t.undo,n=t.redo,i=t.canUndo,s=t.canRedo;return Object(b.jsxs)("div",{className:"UndoButtons",children:[Object(b.jsxs)("button",{className:"undoButton ".concat(i?"":"disabled"),onClick:e,children:[Object(b.jsx)(r.b,{}),Object(b.jsx)("div",{className:"letter",children:"z"})]}),Object(b.jsxs)("button",{className:"redoButton ".concat(s?"":"disabled"),onClick:n,children:[Object(b.jsx)(r.a,{}),Object(b.jsx)("div",{className:"letter",children:"y"})]})]})}n(109),n(110),n(111);function E(t){var e,n,s=t.title,a=null!==(e=t.onExpand)&&void 0!==e?e:function(){},o=null!==(n=t.onCollapse)&&void 0!==n?n:function(){},c=Object(i.useState)(!0),l=Object(u.a)(c,2),h=l[0],v=l[1],d=function(){v(!1),o()},f=function(){v(!0),a()};return Object(b.jsxs)("div",{className:"optionWindow",children:[Object(b.jsxs)("div",{className:"titleBar",children:[Object(b.jsx)("h2",{className:"title",children:s}),h?Object(b.jsx)("button",{onClick:d,children:Object(b.jsx)(r.e,{})}):Object(b.jsx)("button",{onClick:f,children:Object(b.jsx)(r.f,{})})]}),Object(b.jsx)("div",{style:{display:h?"block":"none"},children:t.children})]})}n(112);function D(t){return"\n        rgba(\n            ".concat(t.r,",\n            ").concat(t.g,",\n            ").concat(t.b,",\n            ").concat(t.a,"\n        )\n    ")}function U(t,e){return t&&e?t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a:t===e}function T(t){var e=t.color;return Object(b.jsx)("span",{className:"coloredSquareContainer",children:Object(b.jsx)("span",{className:"coloredSquare",style:{background:D(e)}})})}var I=new(function(){function t(){Object(v.a)(this,t),this.name="Color Picker",this.usesColors=!1,this.canvasContext=null,this.options={scale:1},this.color={r:0,g:0,b:0,a:0}}return Object(d.a)(t,[{key:"updateStatus",value:function(t){this.status=t,this.onStatusChange(t)}},{key:"onStatusChange",value:function(t){}},{key:"renderIcon",value:function(){return Object(b.jsx)(r.l,{})}},{key:"getColor",value:function(t){var e=this.canvasContext.getImageData(t.x,t.y,1,1),n=Object(u.a)(e.data,4);return{r:n[0],g:n[1],b:n[2],a:(n[3]/255).toFixed(2)}}},{key:"mouseDown",value:function(t){this.position=t,this.color=this.getColor(t)}},{key:"mouseUp",value:function(t,e){}},{key:"mouseMove",value:function(t){this.color=this.getColor(t);var e=Object(b.jsxs)(b.Fragment,{children:["Getting color data at (",t.x,", ",t.y,"), ",Object(b.jsx)(T,{color:this.color}),"rgba(",this.color.r,", ",this.color.g,", ",this.color.b,", ",this.color.a,")"]});this.updateStatus(e)}}]),t}()),M=n(89),B=Object(i.createContext)(),A={r:0,g:0,b:0,a:1};function F(){return Object(i.useContext)(B)}function H(t){var e=Object(i.useState)(A),n=Object(u.a)(e,2),s=n[0],a=n[1],o=Object(i.useState)([s]),c=Object(u.a)(o,2),r=c[0],h=c[1],v=Object(i.useState)([null]),d=Object(u.a)(v,2),f=d[0],j=d[1],x={brushColor:s,setBrushColor:a,colorHistory:r,pushColorToHistory:function(t){var e=r.filter((function(e){return!U(e,t)})),n=[t].concat(Object(l.a)(e)).slice(0,32);h(n)},colorPickerColor:f,setColorPickerColor:j};return Object(b.jsx)(B.Provider,{value:x,children:t.children})}var Y=new(function(){function t(){Object(v.a)(this,t),this.name="Brush",this.usesColors=!0,this.status="",this.previewCanvasContext=null,this.canvasContext=null,this.options={scale:1,AA:!1,replace:!1},this.drawing=!1,this.previousPosition=null}return Object(d.a)(t,[{key:"updateStatus",value:function(t){this.status=t,this.onStatusChange(t)}},{key:"onStatusChange",value:function(t){}},{key:"renderIcon",value:function(){return Object(b.jsx)(r.d,{})}},{key:"plotLine",value:function(t,e,n,i){if(t){t.fillStyle=D(i);for(var s=Math.abs(n.x-e.x),a=Math.abs(n.y-e.y),o=e.x<n.x?1:-1,c=e.y<n.y?1:-1,r=s-a,l=Object(h.a)({},e),u=!0;u;){t.clearRect(l.x,l.y,this.options.scale,this.options.scale),t.fillRect(l.x,l.y,this.options.scale,this.options.scale),u=l.x!==n.x||l.y!==n.y;var v=2*r;v>-a&&(r-=a,l.x+=o),v<s&&(r+=s,l.y+=c)}}}},{key:"drawPixel",value:function(t,e,n){t&&(t.fillStyle=D(n),t.fillRect(e.x,e.y,this.options.scale,this.options.scale),this.drawing&&this.updateStatus("Drawing pixel at ".concat(e.x,", ").concat(e.y)))}},{key:"mouseDown",value:function(t,e){this.drawing=!0,this.drawPixel(this.canvasContext,t,e)}},{key:"mouseUp",value:function(t,e){this.drawing=!1,this.previousPosition=null}},{key:"mouseMove",value:function(t,e){var n=this.drawing?this.canvasContext:this.previewCanvasContext;this.drawPixel(n,t,e),this.drawing&&(this.previousPosition&&this.plotLine(n,this.previousPosition,t,e),this.previousPosition=t)}}]),t}()),V=Object(i.createContext)();function K(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=Object(i.useContext)(V),n=e.activeTool,s=e.setActiveTool,a=e.toolStatus,o=e.scale,c=e.setScale;return void 0===n&&s(t),{activeTool:n,setActiveTool:s,toolStatus:a,scale:o,setScale:c}}function X(t){var e=Object(i.useState)(Y),n=Object(u.a)(e,2),s=n[0],a=n[1],o=Object(i.useState)(""),c=Object(u.a)(o,2),r=c[0],l=c[1],h=Object(i.useState)(1),v=Object(u.a)(h,2),d=v[0],f=v[1];return s.onStatusChange=l,Object(i.useEffect)((function(){l("Selected ".concat(s.name)),f(s.options.scale)}),[s]),Object(b.jsx)(V.Provider,{value:{activeTool:s,setActiveTool:a,toolStatus:r,scale:d,setScale:function(t){s.options.scale=t,f(t)}},children:t.children})}function W(){var t=K().activeTool,e=F(),n=e.brushColor,i=e.setBrushColor,s=e.colorPickerColor;return Object(b.jsx)(E,{title:"Color",children:Object(b.jsx)(M.a,{color:t===I?s:n,onChange:function(t){return i(t.rgb)}})})}n(219);function q(){var t=F(),e=t.brushColor,n=t.setBrushColor,i=t.colorHistory,s=function(t,i){var s=U(e,t)?"selected":null;return Object(b.jsx)("div",{className:"colorButtonContainer",children:Object(b.jsx)("button",{style:{background:D(t)},onClick:function(){return n(t)},className:s})},i)};return Object(b.jsx)(E,{title:"Recent Colors",children:Object(b.jsx)("div",{className:"recentColors",children:i.map(s)})})}n(220);function J(){var t=K(),e=t.scale,n=t.setScale;return Object(b.jsx)(E,{title:"Stroke Options",children:Object(b.jsx)("div",{className:"strokeOptions",children:Object(b.jsxs)("div",{className:"option",children:[Object(b.jsx)("input",{type:"number",id:"scale",className:"scaleInput",value:e,onChange:function(t){return n(t.target.value)}}),Object(b.jsx)("label",{htmlFor:"scale",className:"scaleLabel",children:"Scale: "})]})})})}function z(){return Object(b.jsxs)("div",{className:"toolOptions",children:[Object(b.jsx)(J,{}),Object(b.jsx)(W,{}),Object(b.jsx)(q,{})]})}var G=new(function(){function t(){Object(v.a)(this,t),this.name="Line",this.usesColors=!0,this.status="",this.previewCanvasContext=null,this.canvasContext=null,this.options={scale:1},this.startPosition=null}return Object(d.a)(t,[{key:"updateStatus",value:function(t){this.status=t,this.onStatusChange(t)}},{key:"onStatusChange",value:function(t){}},{key:"renderIcon",value:function(){return Object(b.jsx)(r.h,{})}},{key:"isDrawing",value:function(){return!!this.startPosition}},{key:"drawPixel",value:function(t,e,n){t&&(t.fillStyle=D(n),t.fillRect(e.x,e.y,this.options.scale,this.options.scale))}},{key:"plotLine",value:function(t,e,n,i){if(t){t.fillStyle=D(i);for(var s=Math.abs(n.x-e.x),a=Math.abs(n.y-e.y),o=e.x<n.x?1:-1,c=e.y<n.y?1:-1,r=s-a,l=Object(h.a)({},e),u=!0;u;){t.fillRect(l.x,l.y,this.options.scale,this.options.scale),u=l.x!==n.x||l.y!==n.y;var v=2*r;v>-a&&(r-=a,l.x+=o),v<s&&(r+=s,l.y+=c)}}}},{key:"mouseDown",value:function(t){this.startPosition=t}},{key:"mouseUp",value:function(t,e){this.plotLine(this.canvasContext,this.startPosition,t,e),this.updateStatus("Line drawn between (".concat(this.startPosition.x,", ").concat(this.startPosition.y,") and (").concat(t.x,", ").concat(t.y,")")),this.startPosition=null}},{key:"mouseMove",value:function(t,e){if(this.isDrawing())this.plotLine(this.previewCanvasContext,this.startPosition,t,e);else{var n=this.previewCanvasContext;this.drawPixel(n,t,e)}}}]),t}()),Q=new(function(){function t(){Object(v.a)(this,t),this.name="Rectangle",this.usesColors=!0,this.status="",this.previewCanvasContext=null,this.canvasContext=null,this.options={scale:1},this.startPosition=null}return Object(d.a)(t,[{key:"updateStatus",value:function(t){this.status=t,this.onStatusChange(t)}},{key:"onStatusChange",value:function(t){}},{key:"renderIcon",value:function(){return Object(b.jsx)(r.p,{})}},{key:"isDrawing",value:function(){return!!this.startPosition}},{key:"drawPixel",value:function(t,e,n){t&&(t.fillStyle=D(n),t.fillRect(e.x,e.y,this.options.scale,this.options.scale))}},{key:"plotLine",value:function(t,e,n,i){if(t){t.fillStyle=D(i);for(var s=Math.abs(n.x-e.x),a=Math.abs(n.y-e.y),o=e.x<n.x?1:-1,c=e.y<n.y?1:-1,r=s-a,l=Object(h.a)({},e),u=!0;u;){t.fillRect(l.x,l.y,this.options.scale,this.options.scale),u=l.x!==n.x||l.y!==n.y;var v=2*r;v>-a&&(r-=a,l.x+=o),v<s&&(r+=s,l.y+=c)}}}},{key:"plotRectangle",value:function(t,e,n,i){var s=e,a={x:n.x,y:e.y},o=n,c={x:e.x,y:n.y};this.plotLine(t,s,a,i),this.plotLine(t,a,o,i),this.plotLine(t,o,c,i),this.plotLine(t,c,s,i)}},{key:"mouseDown",value:function(t){this.startPosition=t}},{key:"mouseUp",value:function(t,e){this.plotRectangle(this.canvasContext,this.startPosition,t,e),this.updateStatus("Rectangle drawn between (".concat(this.startPosition.x,", ").concat(this.startPosition.y,") and (").concat(t.x,", ").concat(t.y,")")),this.startPosition=null}},{key:"mouseMove",value:function(t,e){if(this.isDrawing())this.plotRectangle(this.previewCanvasContext,this.startPosition,t,e);else{var n=this.previewCanvasContext;this.drawPixel(n,t,e)}}}]),t}()),Z=new(function(){function t(){Object(v.a)(this,t),this.name="Circle",this.usesColors=!0,this.status="",this.previewCanvasContext=null,this.canvasContext=null,this.options={scale:1},this.startPosition=null,this.radius=null}return Object(d.a)(t,[{key:"updateStatus",value:function(t){this.status=t,this.onStatusChange(t)}},{key:"onStatusChange",value:function(t){}},{key:"renderIcon",value:function(){return Object(b.jsx)(r.g,{})}},{key:"isDrawing",value:function(){return!!this.startPosition}},{key:"plotCircle",value:function(t,e,n,i){if(t){t.fillStyle=D(i);for(var s=Math.abs(this.startPosition.x-n.x),a=-s,o=0,c=2-2*s;a<0;)t.fillRect(e.x-a,e.y+o,this.options.scale,this.options.scale),t.fillRect(e.x-o,e.y-a,this.options.scale,this.options.scale),t.fillRect(e.x+a,e.y-o,this.options.scale,this.options.scale),t.fillRect(e.x+o,e.y+a,this.options.scale,this.options.scale),(s=c)<=o&&(c+=2*++o+1),(s>a||c>o)&&(c+=2*++a+1),this.radius=s}}},{key:"plotShape",value:function(t,e,n,i){this.plotCircle(t,e,n,i)}},{key:"drawPixel",value:function(t,e,n){t&&(t.fillStyle=D(n),t.fillRect(e.x,e.y,this.options.scale,this.options.scale))}},{key:"mouseDown",value:function(t){this.startPosition=t}},{key:"mouseUp",value:function(t,e){this.plotShape(this.shape,this.canvasContext,this.startPosition,t,e),this.updateStatus("Circle drawn at (".concat(this.startPosition.x,", ").concat(this.startPosition.y,")")),this.startPosition=null}},{key:"mouseMove",value:function(t,e){if(this.isDrawing())this.plotShape(this.shape,this.previewCanvasContext,this.startPosition,t,e);else{var n=this.previewCanvasContext;this.drawPixel(n,t,e)}}}]),t}()),$=new(function(){function t(e,n){Object(v.a)(this,t),this.name="Flood Fill",this.usesColors=!0,this.status="",this.previewCanvasContext=null,this.canvasContext=null,this.options={scale:1,AA:!1,replace:!1},this.drawing=!1}return Object(d.a)(t,[{key:"updateStatus",value:function(t){this.status=t,this.onStatusChange(t)}},{key:"onStatusChange",value:function(t){}},{key:"renderIcon",value:function(){return Object(b.jsx)(r.n,{})}},{key:"floodFill",value:function(t,e,n){var i=this;if(U(this.getColor(t),e)){if(t.x<0||t.y<0||t.x>this.canvasContext.canvas.width-1||t.y>this.canvasContext.canvas.height-1)return;if(this.drawPixel(this.canvasContext,t,n),U(this.getColor(t),e))return;var s=t.x,a=t.y;[{x:s+1,y:a},{x:s-1,y:a},{x:s,y:a+1},{x:s,y:a-1}].forEach((function(t){i.floodFill(t,e,n)}))}}},{key:"getColor",value:function(t){var e=this.canvasContext.getImageData(t.x,t.y,1,1),n=Object(u.a)(e.data,4);return{r:n[0],g:n[1],b:n[2],a:n[3]/255}}},{key:"drawPixel",value:function(t,e,n){t&&(t.fillStyle=D(n),t.fillRect(e.x,e.y,this.options.scale,this.options.scale))}},{key:"mouseDown",value:function(t,e,n,i){this.position=t,this.drawing=!0,this.drawing&&this.updateStatus("Flood filling from ".concat(t.x,", ").concat(t.y))}},{key:"mouseUp",value:function(t,e,n,i){this.drawing=!1;var s=this.getColor(t);U(s,e)||this.floodFill(t,s,e,n,i)}},{key:"mouseMove",value:function(t,e){}}]),t}()),_=new(function(){function t(){Object(v.a)(this,t),this.name="Eraser",this.usesColors=!1,this.canvasContext=null,this.options={scale:1},this.drawing=!1,this.previousPosition=null}return Object(d.a)(t,[{key:"updateStatus",value:function(t){this.status=t,this.onStatusChange(t)}},{key:"onStatusChange",value:function(t){}},{key:"renderIcon",value:function(){return Object(b.jsx)(r.i,{})}},{key:"plotLine",value:function(t,e,n){if(t)for(var i=Math.abs(n.x-e.x),s=Math.abs(n.y-e.y),a=e.x<n.x?1:-1,o=e.y<n.y?1:-1,c=i-s,r=Object(h.a)({},e),l=!0;l;){this.erasePixel(t,r),l=r.x!==n.x||r.y!==n.y;var u=2*c;u>-s&&(c-=s,r.x+=a),u<i&&(c+=i,r.y+=o)}}},{key:"erasePixel",value:function(t,e){t&&(t.clearRect(e.x,e.y,this.options.scale,this.options.scale),this.drawing&&this.updateStatus("Erasing pixel at ".concat(e.x,",").concat(e.y)))}},{key:"mouseDown",value:function(t){this.erasePixel(this.canvasContext,t),this.drawing=!0}},{key:"mouseUp",value:function(t,e){this.drawing=!1}},{key:"mouseMove",value:function(t){var e=this.drawing?this.canvasContext:this.previewCanvasContext;this.erasePixel(e,t),this.drawing&&(this.previousPosition&&this.plotLine(e,this.previousPosition,t),this.previousPosition=t)}}]),t}()),tt=new(function(){function t(){Object(v.a)(this,t),this.name="Triangle",this.usesColors=!0,this.status="",this.previewCanvasContext=null,this.canvasContext=null,this.options={scale:1},this.startPosition=null}return Object(d.a)(t,[{key:"updateStatus",value:function(t){this.status=t,this.onStatusChange(t)}},{key:"onStatusChange",value:function(t){}},{key:"renderIcon",value:function(){return Object(b.jsx)(r.s,{})}},{key:"isDrawing",value:function(){return!!this.startPosition}},{key:"drawPixel",value:function(t,e,n){t&&(t.fillStyle=D(n),t.fillRect(e.x,e.y,this.options.scale,this.options.scale))}},{key:"plotLine",value:function(t,e,n,i){if(t){t.fillStyle=D(i);for(var s=Math.abs(n.x-e.x),a=Math.abs(n.y-e.y),o=e.x<n.x?1:-1,c=e.y<n.y?1:-1,r=s-a,l=Object(h.a)({},e),u=!0;u;){t.fillRect(l.x,l.y,this.options.scale,this.options.scale),u=l.x!==n.x||l.y!==n.y;var v=2*r;v>-a&&(r-=a,l.x+=o),v<s&&(r+=s,l.y+=c)}}}},{key:"plotTriangle",value:function(t,e,n,i){var s=e,a={x:n.x,y:e.y},o={x:Math.ceil((n.x-e.x)/2+e.x),y:n.y};console.log(s,a,o),this.plotLine(t,s,a,i),this.plotLine(t,a,o,i),this.plotLine(t,o,s,i)}},{key:"mouseDown",value:function(t){this.startPosition=t}},{key:"mouseUp",value:function(t,e){this.plotTriangle(this.canvasContext,this.startPosition,t,e),this.updateStatus("Triangle drawn between (".concat(this.startPosition.x,", ").concat(this.startPosition.y,") and (").concat(t.x,", ").concat(t.y,")")),this.startPosition=null}},{key:"mouseMove",value:function(t,e){if(this.isDrawing())this.plotTriangle(this.previewCanvasContext,this.startPosition,t,e);else{var n=this.previewCanvasContext;this.drawPixel(n,t,e)}}}]),t}());function et(){var t=K(),e=t.activeTool,n=t.setActiveTool,i=F().colorPickerColor,s=[Y,_,G,tt,Q,Z,$],a=function(t){return Object(b.jsxs)("button",{className:t===e?"active":"",onClick:function(){return n(t)},children:[t.renderIcon(),Object(b.jsx)("div",{className:"number",children:s.indexOf(t)+1})]},t.name)},o=function(){n(I)},c=function(){var t=e===I;return Object(b.jsx)("button",{className:"ColorPickerButton ".concat(t?"active":""),onClick:o,children:Object(b.jsxs)("div",{className:"colorPickerInner",style:t?{background:i}:{},children:[I.renderIcon(),Object(b.jsx)("div",{className:"number",children:"8"})]})})};return Object(b.jsxs)("div",{className:"toolBox",children:[Object(b.jsxs)("div",{className:"toolBar",children:[s.map(a),c(),Object(b.jsx)(R,{})]}),Object(b.jsx)(z,{})]})}n(221),n(222),n(223);function nt(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.getContext("2d");n&&i.clearRect(0,0,e.width,e.height),i.drawImage(t,0,0)}function it(t){var e=t.layer,n=t.onDelete?t.onDelete:function(){},s=O(),a=s.activeLayer,o=s.setActiveLayer,c=s.removeLayer,l=g(),h=l.width,v=l.height,d=Object(i.useRef)(null),f=Object(i.useState)(e.isVisible),j=Object(u.a)(f,2),x=j[0],y=j[1],p=Object(i.useState)(e.isLocked),m=Object(u.a)(p,2),C=m[0],w=m[1],k=Object(i.useState)(e.name),S=Object(u.a)(k,2),P=S[0],L=S[1],N=(null===a||void 0===a?void 0:a.id)===e.id,R="LayerPreview ".concat(N?"active":"");Object(i.useEffect)((function(){var t=e.canvasRef.current,n=d.current,i=function(){nt(t,n),y(e.isVisible),w(e.isLocked),L(e.name)};return e.addUpdateListener(i),function(){e.removeUpdateListener(i)}}),[e]);var E="layerActionButton ".concat(e.isLocked?"inactive":"");return Object(b.jsxs)("div",{className:R,onClick:function(){o(e)},children:[Object(b.jsx)("div",{className:"previewImage",children:Object(b.jsx)("canvas",{className:v>h?"portrait":"landscape",ref:d,width:h,height:v},e.id)}),Object(b.jsxs)("div",{className:"layerPreviewInner",children:[Object(b.jsx)("input",{className:"layerPreviewTitle",type:"text",value:P,onChange:function(t){e.setName(t.target.value),t.stopPropagation()}}),Object(b.jsxs)("div",{children:[Object(b.jsx)("button",{className:"layerActionButton",onClick:function(){return e.toggleVisibility()},children:x?Object(b.jsx)(r.j,{}):Object(b.jsx)(r.k,{})}),Object(b.jsx)("button",{className:"layerActionButton",onClick:function(t){t.stopPropagation(),e.toggleLock()},children:C?Object(b.jsx)(r.m,{}):Object(b.jsx)(r.t,{})}),Object(b.jsx)("button",{className:E,onClick:function(t){t.stopPropagation(),c(e),n()},children:C?Object(b.jsx)(r.q,{}):Object(b.jsx)(r.r,{})})]})]})]})}function st(){var t=O(),e=t.layers,n=t.addLayer,s=L().pushEntryToHistory,a=Object(i.useRef)(!1),o=function(){n(),a.current=!0},c=function(){a.current=!0};Object(i.useEffect)((function(){a.current&&(s(),a.current=!1)}),[e,s]);return Object(b.jsx)(E,{title:"Layers",children:Object(b.jsxs)("div",{className:"LayersPanel",children:[Object(b.jsx)("div",{className:"panelTop",children:Object(b.jsxs)("button",{onClick:o,className:"addLayerButton",children:[Object(b.jsx)(r.o,{})," Add layer"]})}),Object(b.jsx)("div",{className:"layers",children:Object(l.a)(e).reverse().map((function(t){return Object(b.jsx)(it,{layer:t,onDelete:c},t.id)}))})]})})}n(224);var at=n(88);function ot(){var t=O().layers,e=g(),n=e.width,s=e.height,a=Object(i.useRef)(null),o=function(){if(a.current){var t=a.current.toDataURL("image/png");console.log("Exported to url: ",t),Object(at.saveAs)(t,"pxlexport.png")}};Object(i.useEffect)((function(){function e(){var e,n=a.current;n&&((e=n).getContext("2d").clearRect(0,0,e.width,e.height),t.forEach((function(t){var e=t.canvasRef.current;e&&nt(e,n,!1)})))}return e(),t.forEach((function(t){t.addUpdateListener(e)})),function(){t.forEach((function(t){t.removeUpdateListener(e)}))}}),[t]);return Object(b.jsx)(E,{title:"Export",children:Object(b.jsxs)("div",{className:"ExportPanel",children:[Object(b.jsx)("div",{className:"panelTop",children:Object(b.jsxs)("button",{className:"exportButton",onClick:o,children:[Object(b.jsx)(r.c,{})," Export from Layers"]})}),Object(b.jsx)("canvas",{className:"exportPreviewCanvas",ref:a,width:n,height:s})]})})}n(225);function ct(){var t=g(),e=t.width,n=t.setWidth,i=t.height,s=t.setHeight,a=t.scale,o=t.setScale;return Object(b.jsx)(E,{title:"Settings",children:Object(b.jsxs)("div",{className:"settings",children:[Object(b.jsxs)("div",{className:"setting",children:[Object(b.jsx)("input",{type:"number",id:"widthSetting",className:"widthSettingInput",value:e,onChange:function(t){return n(parseInt(t.target.value))}}),Object(b.jsx)("label",{htmlFor:"widthSetting",className:"widthSettingLabel",children:"Width: "})]}),Object(b.jsxs)("div",{className:"setting",children:[Object(b.jsx)("input",{type:"number",id:"heightSetting",className:"heightSettingInput",value:i,onChange:function(t){return s(parseInt(t.target.value))}}),Object(b.jsx)("label",{htmlFor:"heightSetting",className:"heightSettingLabel",children:"Height: "})]}),Object(b.jsxs)("div",{className:"setting",children:[Object(b.jsx)("input",{type:"number",id:"scaleSetting",className:"scaleSettingInput",value:a,onChange:function(t){return o(parseInt(t.target.value))}}),Object(b.jsx)("label",{htmlFor:"scaleSetting",className:"scaleSettingLabel",children:"Scale: "})]})]})})}function rt(){return Object(b.jsxs)("div",{className:"ProjectOptions",children:[Object(b.jsx)(ct,{}),Object(b.jsx)(st,{}),Object(b.jsx)(ot,{})]})}n(226),n(227),n(228);function lt(t){var e=t.layer,n=t.width,s=t.height,a=Object(i.useRef)(null);e.canvasRef=a;var o=Object(i.useState)(e.isVisible),c=Object(u.a)(o,2),r=c[0],l=c[1];Object(i.useEffect)((function(){function t(){l(e.isVisible)}return e.addUpdateListener(t),function(){e.removeUpdateListener(t)}}),[e]);return function(){var t="canvasLayer ".concat(r?"":"hidden");return Object(b.jsx)("div",{className:t,children:Object(b.jsx)("canvas",{ref:a,width:n,height:s})})}()}n(229);function ut(){var t=g(),e=t.previewLayerCanvasRef,n=t.width,i=t.height;return Object(b.jsx)("div",{className:"PreviewLayer",children:Object(b.jsx)("canvas",{ref:e,width:n,height:i,id:"previewLayerCanvas"})})}function ht(t,e){var n=t.offsetX,i=t.offsetY;return{x:Math.floor(n/e),y:Math.floor(i/e)}}function vt(){var t=g(),e=t.setCanvasCursorPosition,n=t.previewLayerCanvasRef,s=t.width,a=t.height,o=t.scale,c=t.setScale,r=O(),l=r.layers,u=r.activeLayer,h=K(),v=h.activeTool,d=h.setActiveTool,f=F(),j=f.brushColor,x=f.setBrushColor,y=f.colorPickerColor,p=f.setColorPickerColor,m=f.pushColorToHistory,C=L().pushEntryToHistory,w=Object(i.useRef)(null),k=Object(i.useRef)({x:null,y:null});Object(i.useEffect)((function(){var t;if(v&&u&&!0!==u.isLocked&&n.current&&(null===u||void 0===u||null===(t=u.canvasRef)||void 0===t?void 0:t.current)){var i=w.current,c=u.canvasRef.current.getContext("2d");v.canvasContext=c;var r=n.current.getContext("2d");v.previewCanvasContext=r;var l=function(t){var e=t.button,n=ht(t,o);if(!(n.x<0||n.x>s-1||n.y<0||n.y>a-1||u.isLocked)&&0===e)v.usesColors&&m(j),v.mouseDown(n,j)},h=function(t){var e=t.button,n=ht(t,o);if(v===I){if(!I.color)return;d(Y),x(I.color),p(D(I.color))}if(!(n.x<0||n.x>s-1||n.y<0||n.y>a-1||u.isLocked)){if(0===e)v.mouseUp(n,j),C(),u.onUpdate();r.clearRect(0,0,s,a)}},f=function(t){var n=ht(t,o);if(!(n.x<0||n.x>s-1||n.y<0||n.y>a-1||u.isLocked)){if(v===I){if(null===I.color)return;p(I.color),p(D(I.color))}(n.x<0||n.x>s-1||n.y<0||n.y>a-1||u.isLocked)&&r.clearRect(0,0,s,a);var i=k.current;i.x===n.x&&i.y===n.y||(r.clearRect(0,0,s,a),n.x>s||n.x<0||n.y>a||n.y<0||v.mouseMove(n,j),k.current=n,e(n))}};return u.onUpdate(),i.addEventListener("mousedown",l),i.addEventListener("mouseup",h),i.addEventListener("mousemove",f),function(){i.removeEventListener("mousedown",l),i.removeEventListener("mouseup",h),i.removeEventListener("mousemove",f)}}}),[v,d,u,l,o,c,s,a,j,x,y,p,m,e,n,C]);return function(){var t=a*o,e={width:"".concat(s*o,"px"),height:"".concat(t,"px")};return Object(b.jsxs)("div",{className:"pixelCanvas ".concat(u?"":"invisible"),id:"pixelCanvas",ref:w,style:e,children:[l.map((function(t){return Object(b.jsx)(lt,{layer:t,width:s,height:a},t.id)})),Object(b.jsx)(ut,{})]})}()}function dt(){var t=g(),e=t.width,n=t.height,s=t.setScale,a=L(),o=a.undo,c=a.redo,r=K().setActiveTool,l=Object(i.useRef)(null),u=g(),h=u.canvasX,v=u.setCanvasX,d=u.canvasY,f=u.setCanvasY;Object(i.useEffect)((function(){var t=function(t){e>=1e3||n>=1e3?(t.deltaY<0&&s((function(t){return t+.25})),t.deltaY>0&&s((function(t){return t-.25}))):(t.deltaY<0&&s((function(t){return t+1})),t.deltaY>0&&s((function(t){return t-1})))},i=function(t){2&t.buttons&&(v((function(e){return e+t.movementX})),f((function(e){return e+t.movementY})))},a=function(t){if("INPUT"!==document.activeElement.tagName){var e=(t=t||window.event).which||t.keyCode,n=t.ctrlKey?t.ctrlKey:17===e,i=t.shiftKey?t.shiftKey:16===e,s=t.metaKey?t.metaKey:91===e;if(n&&!i&&90===e||s&&!i&&90===e||90===e)o();else if(n&&89===e||n&&i&&90===e||s&&89===e||s&&i&&90===e||89===e||i&&90===e)c();else switch(e){case 49:r(Y);break;case 50:r(_);break;case 51:r(G);break;case 52:r(tt);break;case 53:r(Q);break;case 54:r(Z);break;case 55:r($);break;case 56:r(I)}}};if(l.current){var u=l.current;return u.addEventListener("wheel",t),u.addEventListener("mousemove",i),document.addEventListener("keydown",a),function(){u.removeEventListener("wheel",t),u.removeEventListener("mousemove",i),document.removeEventListener("keydown",a)}}}),[l,e,n,s,v,f,o,c,r]);return Object(b.jsx)("div",{className:"workspace",id:"workspace",ref:l,children:Object(b.jsx)("div",{style:{position:"relative",left:h,top:d},children:Object(b.jsx)(vt,{})})})}n(230);function ft(){var t=K(),e=t.activeTool,n=t.toolStatus,i=F().brushColor,s=O().activeLayer,a=g().canvasCursorPosition;return function(){var t;return Object(b.jsxs)("div",{className:"statusBar",children:[Object(b.jsxs)("p",{children:[Object(b.jsx)("span",{children:"Color:"}),Object(b.jsx)(T,{color:i}),Object(b.jsxs)("span",{children:["rgba(",i.r,", ",i.g,", ",i.b,", ",i.a,") | Active Layer: ",null===s||void 0===s?void 0:s.name,"| Cursor Position: (",a.x,", ",a.y,") | Tool: ",e.renderIcon(),null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"none"]})]}),Object(b.jsx)("p",{children:n})]})}()}function jt(){var t=g(),e=t.width,n=t.height,s=t.scale,a=L().pushEntryToHistory,o=O().layers,r=Object(i.useRef)(!1);Object(i.useEffect)((function(){window.addEventListener("contextmenu",(function(t){t.preventDefault()}),!1)}),[]),Object(i.useEffect)((function(){!r.current&&o.length>0&&(a(),r.current=!0)}),[o,a]);return Object(b.jsxs)("div",{className:"App",children:[Object(b.jsxs)(c.a,{children:[Object(b.jsx)("title",{children:"pxl.it"}),Object(b.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"})]}),Object(b.jsxs)("div",{className:"editor",children:[Object(b.jsx)(et,{}),Object(b.jsx)(dt,{width:e,height:n,scale:s}),Object(b.jsx)(rt,{})]}),Object(b.jsx)(ft,{})]})}function xt(){return Object(b.jsx)(X,{children:Object(b.jsx)(H,{children:Object(b.jsx)(p,{children:Object(b.jsx)(C,{children:Object(b.jsx)(N,{children:Object(b.jsx)(jt,{})})})})})})}o.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(xt,{})}),document.getElementById("root"))},94:function(t,e,n){},97:function(t,e,n){},98:function(t,e,n){},99:function(t,e,n){}},[[231,1,2]]]);
//# sourceMappingURL=main.4381d479.chunk.js.map